# -NAME- Playbook

[[_TOC_]]

## Scope
Provide a brief outline of what this Playbook covers

## 1. Preparation

<details>
<summary>Expand/Colapse</summary>

- Create and maintain a list of 
    - all domains owned by Brunelcare.
        - This can prevent you from taking actions against our own domains
    - all people of can register domains
- Create email template 
    - to notify all employees of ongoing phishing campaign against the organisation 
    - to contact hosting companies for domain take down
    - to inform 3rd party to take actions against phishing on there infra (Microsoft, Cloudflare, HSO etc.)
- Ensure that:
    - Mail anti-malware/anti-spam/anti-phish solutions are in place.
    - Users know how to report phish
    - Detection exists for office documents spawning processes
        - PowerShell
        - CMD
        - WMI
        - MSHTA
        - Etc.
- Perform a Tabletop exercise to ensure all aspects of the Playbook are working
    - After publication
    - At least once a year
    - Test/Validate: 
        - [Customer's Cards](Customers)
        - Internal Contact and Escalation Paths
- Review threat intelligence for 
    - threats to the organisation, 
    - brands and the sector, 
    - common patterns 
    - newly developing risks and vulnerabilities
- Ensure  appropriate  access  to  any  necessary  documentation  and  information, including out-of-hours access, for the following
    - IR Playbgns to highlight information security risks faced by employees, including: 
    - Phishing attacks and malicious emails;
    - Ransomware;
    - Reporting a suspected cyber incident.

### Tool Access and Provisioning

#### Tool1
Please referer to [Tool1 Documentation](../Products/TOOL.md)

#### Tool2
Please referer to [Tool2 Documentation](../Products/TOOL.md)

### Assets List
- A list of assets and owners should exist and be available for the following
    - Customers Assets
        - Owners
        - Contacts
        - Pre-authorised actions
    - Company Assets 
        - Owners
        - Contacts
        - Administrators
        - Pre-autorised actions
- Type of assets inventory needed
    - Endpoints
    - Servers
    - Network Equipements
    - Security Appliances
    - Network Ranges
        - Public
        - Private
        - VPN / Out of Band
            - Employees
            - Partners
            - Clients

</details>

## 2. Detect
<details>
<summary>Expand/Colapse</summary>

### Workflow
<details open>
<summary>Expand/Colapse</summary>

![-NAME- Workflow](Workflows/-NAME--Workflow-Detect.png)

</details>

### Identify Threat Indicators
<details open>
<summary>Expand/Colapse</summary>

#### Alerts
Alerts are be generated by different systems owned by the Infrastructure/Security team. The main sources for alerts are  
- ITSM Tickets
- SIEM/GreyLog
- Anti-Virus / EDR
- Configured Alerts
- Reports
    - DNS
    - Web Proxy
- Errors from mail servers

#### Notifications
Notifications are comming from external sources usually via email, Teams or phone. The main sources for notifications are  
- Users (internal)
- Recipients of emails (external)
- Third Parties
- ISP
- Mail Providers

</details>

### Indentify Risks Factors
<details open>
<summary>Expand/Colapse</summary>

#### Common
- Credential Theft
- Malware Delivery
- Criminal Activities
    - Blackmail / Ransom

#### Company Specific
- Financial Losses
    - Loss of contract
    - Contract not renewed
    - Lower bid to our clients
    - Fines
        - Regulation

</details>

### Data Collection
This section describes the information that should be collected and documented about the incident  
<details open>
<summary>Expand/Colapse</summary>

Domains  
- Reputation
- Registrar
- Owner
- IP
- Multistage / Redirect
- Technologies of the site
    - WordPress
    - Joomla
    - Custom Page (credential phish)

IP  
- Reputation
- Owner
- Geo Localisation
- Other domains on that IP

</detials>

### Categorize
<details open>
<summary>Expand/Colapse</summary>

Determine the type of 


</details>

### Triage 
<details open>
<summary>Expand/Colapse</summary>

Determine
- Impact
    - Of 
    - Financial
    - Data loss
- Scope (Nb of people)

</details>
</details>
</details>

## 3. Analyze
<details open>
<summary>Expand/Colapse</summary>

### Workflow
<details open>
<summary>Expand/Colapse</summary>

![-NAME- Workflow](Workflows/-NAME--Workflow-Analyze.png)

</details>

### Verify
<details open>
<summary>Expand/Colapse</summary>

In conjunction with a senior member of the Digital Services Team  
- Double-check previous data
- Rule out False Positive

</details>


### Identify IOCs
<details open>
<summary>Expand/Colapse</summary>

- Validate hashes
    - [VirusTotal](../Tools/README.md#virus-total)
    - [Hybrid Analysis](Tools/README.md#hybrid-analysis)
- Validate links
    - [VirusTotal](../Tools/README.md#virus-total)
    - [Hybrid Analysis](../Tools/README.md#hybrid-analysis)
    - [URLScan](../Tools/README.md#urlscan)
- ID other addresses, domains, IPs
    - [VirusTotal](../Tools/README.md#virus-total)
    - [Hybrid Analysis](../Tools/README.md#hybrid-analysis)
    - [Talos Intelligence](../Tools/README.md#hybrid-analysis)
- Search Threat Intel sources
    - [VirusTotal](../Tools/README.md#virus-total)
    - [Hybrid Analysis](../Tools/README.md#hybrid-analysis)
    - [Talos Intelligence](../Tools/README.md#hybrid-analysis)
- Disk forensics on recipient's endpoint

</details>

### Scan Enterprise
<details open>
<summary>Expand/Colapse</summary>

- Update FW, IDS, etc. rules w/ IOCs
- Search endpoints for IOCs w/ EDR

</details>

### Update Scope
<details open>
<summary>Expand/Colapse</summary>

- Update lists of
    - affected endpoints
    - affected Company Entities
    - affected clients

</details>

### Scope Validation
<details open>
<summary>Expand/Colapse</summary>

Have all the machines been identified? 
If you find further traces of phishing or new IOCs go back through this step.  

When you are done identifying all compromised:  
- Hosts

And investigated all:  
- URLs
- Domains
- IP
- Ports
- Files
- Hash

Go to the next phase <Contain/Eradicate>

</details>

</details>


## 4. Contain / Eradicate
<details open>
<summary>Expand/Colapse</summary>

### Workflow
<details open>
<summary>Expand/Colapse</summary>

![-NAME- Workflow](Workflows/-NAME--Workflow-Contain_Eradicate.png)

</details>

### Block
<details open>
<summary>Expand/Colapse</summary>

- Update FW, Proxy, etc. rules
- Blackhole DNS
- Submit to Partners
    - AV/EDR Vendor
    - Web Filter Vendor
    - etc.

</details>

### Validate User's Actions
<details open>
<summary>Expand/Colapse</summary>



</details>

### Malware Infection?
<details open>
<summary>Expand/Colapse</summary>

If there were malicious attachments that were openned we need to assume the endpoint(s) was/were infected by malware.  
Please continue to the [Malware Playbook](../IRP-Malware/README.md)  

</details>


### Close Monitoring
<details open>
<summary>Expand/Colapse</summary>

- Monitor for 
    - Related incoming messages
    - Internet connections to IOC
    - New files that matches hashes identified

</details>


### All Affected Endpoints Contained?
<details open>
<summary>Expand/Colapse</summary>

If all affected endpoints have been contained, you can go to the next phase, otherwise continue bellow.  

</details>

### New IOC Discovered?
<details open>
<summary>Expand/Colapse</summary>

If a new IOC is discovered, go back to the [Analyse Phase](README.md#3-analyze)
</details>
</details>

## 5. Recover
<details open>
<summary>Expand/Colapse</summary>

### Workflow
<details open>
<summary>Expand/Colapse</summary>

![-NAME- Workflow](Workflows/-NAME--Workflow-Recover.png)

</details>

### Update Defences
<details open>
<summary>Expand/Colapse</summary>

Determine which of the following rules needs to be removed and which needs to stay in the following list:  
- Firewall Rules
- EDR 
    - ban hashes
    - ban domains
    - Containment
- Proxy Block

</details>

### All Affected Endpoints Recovered?
<details open>
<summary>Expand/Colapse</summary>

If all affected endpoints have been contained, you can go to the next phase, otherwise continue bellow.  

</details>

### Validate Countermeasures
<details open>
<summary>Expand/Colapse</summary>

Determine if legitimate elements are blocked by:  
- Proxy
- Firewall
- EDR

If so, go back to [Update Defenses](README.md#update-defenses)
Otherwise, go to the next phase <Post Incident>

</details>
</details>

## 6. Post Incident
<details>
<summary>Expand/Colapse</summary>

### Workflow
<details open>
<summary>Expand/Colapse</summary>

![-NAME- Workflow](Workflows/-NAME--Workflow-Post_Incident.png)

</details>

### Incident Review
<details open>
<summary>Expand/Colapse</summary>

- What worked
- What didn't work

</details>

### Update Mode of Operations
<details open>
<summary>Expand/Colapse</summary>

Update the following documents as required:  
- Policies
- Processes
- Procedures
- Playbooks
- Runbooks

Update Detection Rules in:  
- SIEM
- Anti-Spam
- Malware Gateway
- EDR
- Microsoft Defender
- Other security solution

</details>

### Review Defensive Posture
<details open>
<summary>Expand/Colapse</summary>

- Schedule review of newly introduced rules in6 months
- Are the following still applicatble
    - Firewall Rules
    - Proxy Rules for C2
    - AV / EDR custom Signatures
    - IPS Signatures

</details>

### User Awareness Training
<details open>
<summary>Expand/Colapse</summary>


</details>

</details>

# References

This Playbook was built using the following references:  
https://www.dfir.training/index.php?option=com_jreviews&format=ajax&url=media/download&m=14tt1&1600804844570  
https://www.gov.scot/publications/cyber-resilience-incident-management/  
https://github.com/certsocietegenerale/IRM/tree/master/EN  
https://www.incidentresponse.com/playbooks/  
https://ayehu.com/cyber-security-incident-response-automation/top-5-cyber-security-incident-response-playbooks/  
https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-61r2.pdf  
